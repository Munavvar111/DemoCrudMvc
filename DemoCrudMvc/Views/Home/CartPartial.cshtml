@model List<DAL.ViewModals.CartItems>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<style>
    .cart-item {
        display: flex;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }

        .cart-item img {
            width: 100px;
            height: auto;
            margin-right: 20px;
        }

    .cart-item-details {
        flex-grow: 1;
    }

    .quantity-controls {
        display: flex;
        align-items: center;
    }

        .quantity-controls input {
            width: 50px;
            text-align: center;
            margin: 0 5px;
        }
</style>

<div class="container mt-5">
    <h2>Shopping Cart</h2>
    <div id="cart-items">
        @foreach (var item in Model)
        {
            <div class="cart-item" data-product-id="@item.ProductId">
                <img src="~/uploads/@item.CartFileName" alt="@item.CartFileName" />
                <div class="cart-item-details">
                    <h4>@item.CartItemName</h4>
                    <div>Price: $<span class="price">@item.CartItemPrice</span></div>
                    <div class="quantity-controls">
                        <button class="btn btn-secondary" onclick="updateQuantity(@item.ProductId, -1)">-</button>
                        <input type="number" value="@item.CartItemQuantity" min="1" readonly />
                        <button class="btn btn-secondary" onclick="updateQuantity(@item.ProductId, 1)">+</button>
                    </div>
                    <div>Total: $<span class="total-price">@item.CartItemPrice</span></div>
                </div>
            </div>
        }
    </div>
    <div class="mt-4">
        <button class="btn btn-primary" onclick="checkout()">Proceed to Checkout</button>
    </div>
</div>

<script>
    function updateQuantity(productId, change) {
        var cartItem = $(`[data-product-id="${productId}"]`);
        var quantityInput = cartItem.find('input[type="number"]');
        var newQuantity = parseInt(quantityInput.val()) + change;

        if (newQuantity < 1) return;

        quantityInput.val(newQuantity);

        var price = parseFloat(cartItem.find('.price').text());
        var totalPrice = (price * newQuantity).toFixed(2);
        cartItem.find('.total-price').text(totalPrice);

        $.post('/Cart/UpdateQuantity', { productId: productId, quantity: newQuantity }, function (response) {
            if (!response.success) {
                alert('Failed to update quantity');
            }
        });
    }

    function checkout() {
        window.location.href = '/Checkout';
    }
</script>
