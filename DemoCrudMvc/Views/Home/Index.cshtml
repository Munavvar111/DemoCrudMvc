@model List<DAL.DataModels.Product>;

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

@if (TempData.ContainsKey("SuccessMessage"))
{
    <script>
        $('#loader').fadeIn().promise().done(function () {
            Swal.fire({
                title: 'Success!',
                text: '@TempData["SuccessMessage"]',
                icon: 'success',
                showConfirmButton: false,
                timer: 1500
            })
        });
    </script>
}
@if (TempData.ContainsKey("Error"))
{
    <script>
        $('#loader').fadeIn().promise().done(function () {
            Swal.fire({
                title: 'Error!',
                text: '@TempData["Error"]',
                icon: 'error',
                showConfirmButton: false,
                timer: 1500
            })
        });
    </script>
}

<style>
    .image-slider {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 75%; /* Adjust based on the aspect ratio of your images */
        overflow: hidden;
    }

    .slider-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }

        .slider-image.active {
            opacity: 1;
        }

</style>

<div class="container-fluid mt-3 row bg-white">
    <div class="col-md-2 border-end border-md-end-none">
        <div class="p-3 d-flex gap-3 align-items-center">

            <span class="material-symbols-outlined  fs-3 border rounded-circle p-2 bg-light">
                filter_alt
            </span>
            <span class="fw-bolder">Filter</span>
        </div>
        <div class="mt-3">
            <h5>Price</h5>
            <input type="checkbox" id="price_range_1" value="0-100">
            <label for="price_range_1">$0 - $100</label><br>

            <input type="checkbox" id="price_range_2" value="100-200">
            <label for="price_range_2">$100 - $200</label><br>

            <input type="checkbox" id="price_range_3" value="200-500">
            <label for="price_range_3">$200 - $500</label><br>

             <input type="checkbox" id="price_range_4" value="500-1000">
            <label for="price_range_4">$500 - $1000</label><br>

             <input type="checkbox" id="price_range_5" value="1000-2222222">
            <label for="price_range_5">$1000+</label><br>


        </div>

    </div>
    <div class="col-md-10 bg-white">
        <div class="d-flex justify-content-between flex-wrap p-3 row">
            <div class="col-md-6">

            <h4>Product Listing<span class="text-muted fw-bolder">(@ViewBag.Count)  </span></h4>
            </div>
            <div class="col-md-4">

            <div class="input-group input-group-height">

                <input class="form-control" type="search" placeholder="Search Products" aria-label="Search" id="searchInput">
            </div>
            </div>
        </div>

        <div id="ProductListingPartial"></div>

    </div>
</div>


<script>
    function ChangeCart(product) {
        let cart = JSON.parse(localStorage.getItem('cart'));
        if (!Array.isArray(cart)) {
            cart = [];
        }
        const productIndex = cart.findIndex(item => item === product);
        console.log(productIndex)
        if (productIndex === -1) {
            cart.push(product);
            localStorage.setItem('productId', JSON.stringify(cart));
            $.ajax({
                method: "POST",
                url: "/Home/CartViewBag",
                success: function (data) {
                    var products = JSON.parse(localStorage.getItem('cart'));
                    console.log(products)
                    var count = products ? products.length : 0;
                    $('#cartCount').text(count);
                }
            })
        } else {
            Swal.fire(
                'In Cart!',
                'Your Product  has been Already  Send In Cart.',
                'success'
            )
        }
    }
</script>
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel">Image Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <img src="" class="img-fluid" id="modalImage">
            </div>
        </div>
    </div>
</div>
<script>
    var myModal = document.getElementById('imageModal');
    myModal.addEventListener('show.bs.modal', function (event) {
        var imageFilename = event.relatedTarget.getAttribute('data-image');
        var imagePath = '@Url.Content("~/uploads/")'; // Assuming you're using Razor syntax
        var modalImage = myModal.querySelector('#modalImage');
        modalImage.src = imagePath + imageFilename;
    });
</script>
<script>
    $(document).ready(function () {
        filterTable()
    });

    const debounce = (func, delay) => {
        let debounceTimer;
        return function () {
            const context = this;
            const args = arguments;
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => func.apply(context, args), delay);
        };
    };
    $("#searchInput").on("input", debounce(function () {
        console.log("inputchange")
        filterTable();
    }, 500));
    function handleCheckboxChange() {
        filterTable();
    }

    $("input[type='checkbox']").change(debounce(handleCheckboxChange, 500));

    function filterTable() {
        var searchValue = $("#searchInput").val();

        var selectedPrices = [];
        $("input[type='checkbox']:checked").each(function () {
            selectedPrices.push($(this).val());
        });
        console.log(selectedPrices)
        $.ajax({
            type: "GET",
            url: "/Home/GetProductListing",
            traditional: true,
            data: { searchValue: searchValue, selectedPrices: selectedPrices },
            success: function (data) {
                $('#ProductListingPartial').html(data);
            }
        });
    }
</script>
