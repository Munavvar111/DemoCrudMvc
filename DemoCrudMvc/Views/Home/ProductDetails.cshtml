@model DAL.DataModels.Product
@{
    ViewData["Title"] = "ProductDetails";
}

<style>
    .custom-product-card {
        margin-top: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
    }

        .custom-product-card .card-body {
            padding: 20px;
        }

        .custom-product-card .thumbnail img {
            cursor: pointer;
            transition: transform 0.3s;
        }

            .custom-product-card .thumbnail img:hover {
                transform: scale(1.1);
            }

        .custom-product-card .image-gallery img {
            cursor: pointer;
            transition: transform 0.3s;
        }

            .custom-product-card .image-gallery img:hover {
                transform: scale(1.05);
            }

        .custom-product-card .product-details {
            padding: 20px;
        }

        .custom-product-card .product-name {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .custom-product-card .product-description {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .custom-product-card .product-price {
            font-size: 1.2rem;
            color: #007bff;
        }

        .custom-product-card .product-quantity input {
            width: 60px;
            text-align: center;
        }

        .custom-product-card .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
</style>

<div class="container mt-5 mb-5 bg-white shadow-lg">
    
    <div class="custom-product-card ">
        <div class="card-body ">
            <div class="row gap-3">
                <div class="col-md-2">
                    <div class="d-flex flex-column gap-3">
                        @foreach (var item in Model.ProductPhotos)
                        {
                            <div class="thumbnail" onclick="SetMainImage('@Url.Content("~/uploads/" + @item.PhotoName)')">
                                <img src="~/uploads/@item.PhotoName" width="50" />
                            </div>
                        }
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="image-gallery">
                        <img id="mainImage" src="~/uploads/@Model.FeaturePhoto" width="400" onclick="OpenModal()" />
                    </div>
                </div>
                <div class="col-md-5 mx-3 bg-white">
                    <div class="product-details">
                        <div class="product-name">@Model.ProductName</div>
                        <div class="product-description">@Html.Raw(@Model.Description)</div>
                        <div class="product-price">Price: $@Model.Price</div>
                        <div class="product-quantity">
                            Quantity:
                            <input type="number" id="quantity" name="quantity" value="1" min="1">
                        </div>
                        <button class="btn btn-primary mt-3" onclick="addToCart()">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for displaying the image carousel -->


<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        function SetMainImage(imageSrc) {
            document.getElementById('mainImage').src = imageSrc;
        }

        function OpenModal() {
            const mainImageSrc = document.getElementById('mainImage').src;
            var modifiedUrl = decodeURIComponent(mainImageSrc.replace('https://localhost:7290', ''));
            console.log(modifiedUrl)
            const modal = $('#imageModal');
            const carouselItems = $('#carousel-inner .carousel-item');
            carouselItems.removeClass('active');

            carouselItems.each(function (index, element) {
                console.log($(element).find('img').attr('src'))
                if ($(element).find('img').attr('src') === modifiedUrl) {
                console.log("hiifromhere")
                    $(element).addClass('active');
                }
            });

            modal.modal('show');
        }

        window.SetMainImage = SetMainImage;
        window.OpenModal = OpenModal;

        document.querySelectorAll('.thumbnail').forEach((div) => {
            div.addEventListener('click', function () {
                SetMainImage(this.querySelector('img').src);
            });
        });

        document.getElementById('mainImage').addEventListener('click', function () {
            OpenModal();
        });
    });
</script>

<style>
    .thumbnail {
        cursor: pointer;
    }
</style>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<div id="imageModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="carouselExample" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner" id="carousel-inner">
                        @foreach (var item in Model.ProductPhotos)
                        {
                            <div class="carousel-item">
                                <img src="~/uploads/@item.PhotoName" class="d-block w-100">
                            </div>
                        }
                    </div>
                    <a class="carousel-control-prev" href="#carouselExample" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExample" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>